<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="PB">
<meta name="dcterms.date" content="2025-02-20">
<meta name="description" content="A blog post on Limits of the Quantitative Approach to Bias and Fairness.">

<title>Limits of the Quantitative Approach to Bias and Fairness – My Machine Learning Projects Blogs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6de787833effe4777a6777a5e05fb578.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background-image: url(../../img/landscape.png);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My Machine Learning Projects Blogs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Limits of the Quantitative Approach to Bias and Fairness</h1>
                  <div>
        <div class="description">
          A blog post on Limits of the Quantitative Approach to Bias and Fairness.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>PB </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In today’s day and age where data-driven decisions increasingly affect everyday lives—from credit scoring to hiring practices—quantitative methods have become central to assessing discrimination and bias. In his 2022 speech, Arvind Narayanan argues that “currently quantitative methods are primarily used to justify the status quo” <span class="citation" data-cites="narayanan2022limits">Narayanan (<a href="#ref-narayanan2022limits" role="doc-biblioref">2022</a>)</span>. He challenges the prevalent view that numbers provide an objective measure of fairness, suggesting instead that quantitative approaches may inadvertently reinforce existing social hierarchies. This essay examines Narayanan’s position, discusses the dual nature of quantitative methods in both uncovering and perpetuating discrimination, and reviews a case study where quantitative techniques have been beneficial in illuminating fairness issues in decision-making processes.</p>
</section>
<section id="narayanans-position-on-quantitative-methods" class="level2">
<h2 class="anchored" data-anchor-id="narayanans-position-on-quantitative-methods">Narayanan’s Position on Quantitative Methods</h2>
<p>Narayanan’s speech critiques the heavy reliance on quantitative analyses in the study of discrimination. He argues that quantitative methods assume no discrimination unless proven otherwise, placing the burden of proof on those claiming bias. He asserts that this default assumption upholds existing power structures rather than challenging them. When disparities appear in metrics like false-positive rates in criminal risk assessments, they are often explained as statistical noise rather than evidence of systemic injustice <span class="citation" data-cites="narayanan2022limits">Narayanan (<a href="#ref-narayanan2022limits" role="doc-biblioref">2022</a>)</span>.</p>
<p>Furthermore, Narayanan emphasizes that quantitative methods, by their very nature, reduce complex social phenomena to just numbers. By doing this, they risk overlooking the real experiences of those affected by discrimination. While significance tests and confusion matrices show differences in outcomes between racial or gender groups, these metrics alone cannot fully capture the complexity of systemic oppression. This critique challenges scholars and practitioners to consider whether the technical accuracy of quantitative methods always aligns with their social impact.</p>
</section>
<section id="the-benefits-of-quantitative-methods" class="level2">
<h2 class="anchored" data-anchor-id="the-benefits-of-quantitative-methods">The Benefits of Quantitative Methods</h2>
<p>Despite Narayanan’s reservations, quantitative methods have undeniable strengths that have contributed to significant advancements in understanding discrimination. Some of their benefits include:</p>
<ul>
<li><p><strong>Precision and Replicability:</strong> Quantitative techniques, such as formal mathematical definitions of bias and fairness, provide a framework for rigorously measuring disparities. For example, fairness metrics like statistical parity, equality of opportunity, and calibration enable researchers to compare outcomes across groups in a replicable manner <span class="citation" data-cites="barocasFairnessMachineLearning2023">Barocas, Hardt, and Narayanan (<a href="#ref-barocasFairnessMachineLearning2023" role="doc-biblioref">2023</a>)</span>. These methods are especially useful in contexts where decisions must be justified to regulatory bodies or stakeholders.</p></li>
<li><p><strong>Scalability:</strong> Large datasets from various sectors (e.g., criminal justice, hiring, lending) allow quantitative methods to detect subtle patterns of bias that might escape qualitative analyses. Collecting data systematically and analyzing it statistically can uncover trends—such as differences in false-positive rates between demographic groups—that highlight broader systemic issues. These findings can then guide policy decisions to address such disparities.</p></li>
<li><p><strong>Policy Relevance:</strong> Quantitative analyses have played a critical role in policy-making. A notable example is the ProPublica investigation into criminal risk prediction tools, which used statistical tests to show that Black defendants were more likely to be misclassified as high risk compared to white defendants. Although Narayanan critiques the limitations of such studies, it is undeniable that they have driven significant public and policy debates about algorithmic fairness <span class="citation" data-cites="narayanan2022limits">Narayanan (<a href="#ref-narayanan2022limits" role="doc-biblioref">2022</a>)</span>. Quantitative evidence, when appropriately contextualized, can help mobilize reform and promote accountability.</p></li>
</ul>
</section>
<section id="an-example-of-a-beneficial-quantitative-study" class="level2">
<h2 class="anchored" data-anchor-id="an-example-of-a-beneficial-quantitative-study">An Example of a Beneficial Quantitative Study</h2>
<p>One beneficial example of using quantitative methods in the study of fairness is the analysis of credit-scoring algorithms. In the study discussed by Barocas, Hardt, and Narayanan <span class="citation" data-cites="barocasFairnessMachineLearning2023">Barocas, Hardt, and Narayanan (<a href="#ref-barocasFairnessMachineLearning2023" role="doc-biblioref">2023</a>)</span>, researchers used detailed statistical models to assess whether machine learning systems used in credit decisions perpetuated racial or gender disparities. By analyzing large datasets and employing fairness criteria, they were able to identify that certain features—even when not explicitly related to race or gender—acted as proxies for these protected attributes. The study not only highlighted the existence of bias but also suggested modifications to the algorithms that could lead to fairer outcomes.</p>
<p>The strength of this quantitative approach lies in its ability to pinpoint exactly which elements of the data contribute to discriminatory outcomes. For example, confusion matrices and false-positive rates provided clear metrics by which the performance of the credit-scoring model could be judged across different demographic groups. This analysis allowed for the identification of unintended consequences—such as systematically lower credit scores for minority applicants—that might have otherwise been overlooked. Thus, when used carefully and coupled with a deep understanding of the social context, quantitative methods can offer actionable insights that promote more equitable decision-making.</p>
</section>
<section id="the-drawbacks-and-limitations-of-quantitative-approaches" class="level2">
<h2 class="anchored" data-anchor-id="the-drawbacks-and-limitations-of-quantitative-approaches">The Drawbacks and Limitations of Quantitative Approaches</h2>
<p>While the benefits are compelling, the drawbacks of relying solely on quantitative methods are equally significant, as Narayanan and other scholars have pointed out:</p>
<ul>
<li><p><strong>Reductionism and Oversimplification:</strong> Quantitative methods often require reducing complex human experiences and societal structures to numerical values. This abstraction can lead to a failure to account for the context and intersectionality inherent in discrimination. For instance, while statistical tests might show that women are underrepresented in leadership roles, they cannot capture the myriad ways in which gender intersects with race, socioeconomic status, and other factors to produce these outcomes <span class="citation" data-cites="dIgnazioDataFeminism2023">D’Ignazio and Klein (<a href="#ref-dIgnazioDataFeminism2023" role="doc-biblioref">2023</a>)</span>.</p></li>
<li><p><strong>The Null Hypothesis Problem:</strong> As Narayanan argues, the conventional use of the null hypothesis—assuming no discrimination until evidence suggests otherwise—can obscure genuine disparities. By demanding rigorous statistical proof before acknowledging discrimination, quantitative methods may inadvertently uphold the status quo. This methodological choice means that even when quantitative data reveal significant disparities, the interpretation of these results may lean towards rationalizing existing practices rather than questioning them.</p></li>
<li><p><strong>Ignoring Qualitative Nuance:</strong> Quantitative studies may fail to capture the lived experiences of those affected by discrimination. For example, while a machine learning model might quantify the disparity in false-positive rates, it cannot communicate the real-world impact of these errors on individuals’ lives. As critics like Buolamwini and Gebru <span class="citation" data-cites="buolamwiniGenderShades2018">Buolamwini and Gebru (<a href="#ref-buolamwiniGenderShades2018" role="doc-biblioref">2018</a>)</span> have argued, integrating qualitative insights is essential for understanding the human cost of algorithmic bias. Qualitative methods—through interviews, ethnographic research, and case studies—provide context that enriches the quantitative findings.</p></li>
<li><p><strong>Reinforcing Existing Biases:</strong> When historical data, which often reflect long-standing societal prejudices, are used to train machine learning models, the models can perpetuate these biases. This phenomenon is sometimes referred to as “feedback loops,” where biased decisions lead to further bias in future data collection. Cathy O’Neil, in <em>Weapons of Math Destruction</em>, argues that such opaque, unaccountable algorithms can reinforce and even amplify societal inequalities <span class="citation" data-cites="oNeilWeaponsMathDestruction2016">O’Neil (<a href="#ref-oNeilWeaponsMathDestruction2016" role="doc-biblioref">2016</a>)</span>. In such cases, quantitative methods may end up reinforcing the very inequalities they are meant to expose, unless corrective interventions are thoughtfully implemented.</p></li>
</ul>
</section>
<section id="balancing-quantitative-and-qualitative-approaches" class="level2">
<h2 class="anchored" data-anchor-id="balancing-quantitative-and-qualitative-approaches">Balancing Quantitative and Qualitative Approaches</h2>
<p>The critique posed by Narayanan calls for a balanced approach that integrates both quantitative and qualitative methods. Quantitative analysis provides the rigorous statistical evidence needed to identify and measure disparities, while qualitative research adds depth and context to understand the root causes and real-world impacts of these disparities. For instance, while the quantitative study of credit-scoring algorithms identified proxy variables that contributed to discriminatory outcomes, qualitative interviews with affected applicants could reveal how these algorithmic decisions influence their access to financial services and overall economic mobility.</p>
<p>Several scholars have advocated for mixed-methods research as a way to bridge the gap between numerical data and human experience. Selbst et al. <span class="citation" data-cites="selbstFairnessAbstraction2019">Selbst et al. (<a href="#ref-selbstFairnessAbstraction2019" role="doc-biblioref">2019</a>)</span> argue that incorporating qualitative insights into quantitative frameworks not only enriches the analysis but also helps to avoid the pitfalls of reductionism. Such approaches are particularly valuable in sensitive areas like discrimination, where numbers alone cannot capture the full spectrum of injustice.</p>
</section>
<section id="my-position-on-narayanans-claim" class="level2">
<h2 class="anchored" data-anchor-id="my-position-on-narayanans-claim">My Position on Narayanan’s Claim</h2>
<p>After weighing the evidence and arguments, I find merit in Narayanan’s claim that quantitative methods, when used in isolation, risk justifying the status quo. It is clear that the methodological choices—such as adopting the null hypothesis of no discrimination—can skew interpretations and obscure the broader social dynamics at play. However, I would argue that quantitative methods are not inherently harmful; rather, their impact depends on how they are applied and interpreted.</p>
<p>When used with qualitative research, quantitative methods become a powerful tool for highlighting inequities and informing policy. For example, the credit-scoring study discussed earlier shows that with careful design and a willingness to interrogate the data critically, quantitative analyses can lead to meaningful reforms. Therefore, I agree with Narayanan’s caution against a purely quantitative lens but also advocate for a balanced methodology that leverages the strengths of both approaches.</p>
<p>In practice, decision-makers and researchers should be transparent about the limitations of their quantitative analyses. They should complement statistical findings with qualitative research to ensure that the numbers do not become an end in themselves but serve as a means to a more comprehensive understanding of discrimination. This integrative approach can help shift the focus from merely justifying existing practices to actively challenging and transforming them.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Quantitative methods have transformed the study of discrimination by offering precise, scalable, and policy-focused tools for analyzing disparities. However, as Narayanan (2022) points out, these methods have significant limitations, including the risk of reinforcing the status quo when used without proper context. For example, credit-scoring algorithms show that while quantitative techniques can detect and reduce bias, they must be paired with qualitative insights to fully address the complexities of discrimination.</p>
<p>Ultimately, the debate over fairness in quantitative methods is not about choosing between data and narratives. Instead, it requires integrating both—valuing statistical rigor while remaining mindful of the social, historical, and human factors that shape discrimination. By doing so, researchers and policymakers can use quantitative methods to promote meaningful change rather than unintentionally upholding existing inequities.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-barocasFairnessMachineLearning2023" class="csl-entry" role="listitem">
Barocas, Solon, Moritz Hardt, and Arvind Narayanan. 2023. <em>Fairness and Machine Learning: Limitations and Opportunities</em>. Cambridge, Massachusetts: The MIT Press.
</div>
<div id="ref-buolamwiniGenderShades2018" class="csl-entry" role="listitem">
Buolamwini, Joy, and Timnit Gebru. 2018. <span>“Gender Shades: Intersectional Accuracy Disparities in Commercial Gender Classification.”</span> <em>Proceedings of Machine Learning Research</em> 81: 1–15.
</div>
<div id="ref-dIgnazioDataFeminism2023" class="csl-entry" role="listitem">
D’Ignazio, Catherine, and Lauren F. Klein. 2023. <em>Data Feminism</em>. Cambridge, Massachusetts: The MIT Press.
</div>
<div id="ref-narayanan2022limits" class="csl-entry" role="listitem">
Narayanan, Arvind. 2022. <span>“The Limits of the Quantitative Approach to Discrimination.”</span> Speech.
</div>
<div id="ref-oNeilWeaponsMathDestruction2016" class="csl-entry" role="listitem">
O’Neil, Cathy. 2016. <em>Weapons of Math Destruction: How Big Data Increases Inequality and Threatens Democracy</em>. New York: Crown.
</div>
<div id="ref-selbstFairnessAbstraction2019" class="csl-entry" role="listitem">
Selbst, Andrew D. et al. 2019. <span>“Fairness and Abstraction in Sociotechnical Systems.”</span> In <em>Proceedings of FAT’19</em>, 59–68. ACM.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>